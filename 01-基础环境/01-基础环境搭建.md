## 一 虚拟机环境创建

需要搭建三台虚拟机环境。  

步骤一：安装vmware，并确保其服务都启动
```
services.msc            # 使用该命令查看 vm开头的服务是否启动，没有启动的启动
```

步骤二：查看vmware网络配置
```
确保控制面板中的网络连接适配器中存在vmnet8连接
确认其IP4使用自定义地址，
确保网段地址都是未被上述虚拟机使用的。
默认网关一定要和vmware中NAT一致，笔者这里是`192.168.120.2` 

# 查看vmware网关方式：VMware菜单编辑-虚拟网络编辑器-NAT模式-NAT设置中网关的  
```

步骤三：安装操作系统
```
虚拟机推荐直接使用安装文件安装（centos6.9-clean-machine），
下载地址：链接：https://pan.baidu.com/s/1qsBDc0Cfog47ybE0o4kbpw  提取码：4sbc 

复制该文件夹为三分，命名为CDH1,CDH2,CDH3，使用vmware依次打开，
并分别设置不同的mac地址后启动（右键设置-网络适配器-高级-生成MAC地址） 

贴士：内存可以调高到2G以上，用户名都是root，密码都是123456   
```

步骤四：配置Linux mac地址：
```

## 4.1 修改mac地址：删除列出的Mac地址配置，只保留当前mac配置，并将eth改为 eth0
vim /etc/udev/rules.d/70-persistent-net.rules

## 4.2 修改网络配置：mac地址修改为上述地址，并修改,添加配置
vim /etc/sysconfig/network-scripts/ifcfg-eth0

ONBOOT=yes
BOOTPROTO=static
IPADDR=192.168.120.111      # 三台机器依次进行上述配置，IP依次为111，112，113
GATEWAY=192.168.120.2       # 此处是虚拟机本身的网关
NETMASK=255.255.255.0
DNS1=8.8.8.8

## 4.3 修改域名配置：将安装的三台机器规划为如下设置，IP第三部分必须与vmware网关一致
主机        IP地址              主机名
第一台机器	192.168.120.111     node01.hadoop.com
第一台机器	192.168.120.112	    node02.hadoop.com
第一台机器	192.168.120.113	    node03.hadoop.com
# 修改方式
vim /ect/sysconfig/network
HOSTNAME=node01.hadoop.com

## 4.4 修改host映射
vim /etc/hosts  
# 每台机器都如下添加 
192.168.120.111 node01.hadoop.com node01
192.168.120.112 node02.hadoop.com node02
192.168.120.113 node03.hadoop.com node03

# 三台机器依次执行上述操作
```

步骤五：
```
# 依次重启：reboot -h now
# ping www.baidu.com  能ping通则上述配置通过
# 推荐以后使用SSH客户端连接
```

## 二 大数据集群环境准备

在第一章节，我们创建完毕了三台虚拟机环境，此时可以使用一些ssh工具连接，方便操作。下面是对这三台虚拟机进行一些额外配置。 

#### 2.1 关闭防火墙 与 selinux

```
service iptables stop		# 关闭防火墙
chkconfig iptables off		# 关闭防火墙开机自启动

vim /etc/selinux/config		# 注释 SELINUX=enforcing，添加新的：SELINUX=disabled

# 设置完毕后重启
reboot  -h  now
```

#### 2.2 配置免密登录

第一步：三台机器分别执行生成密钥命令：
```
ssh-keygen -t rsa           # 连敲三次回车
```

第二步：拷贝公钥到同一台机器，这里分别将node02和node03都拷贝到node01
```
ssh-copy-id node01.hadoop.com
```

第三步：拷贝第一台机器的公钥到其他机器，进入第一台机器命令行
```
scp /root/.ssh/authorized_keys node02.hadoop.com:/root/.ssh
scp /root/.ssh/authorized_keys node03.hadoop.com:/root/.ssh
```

测试：在第二台上登录第一台服务器：
```
ssh node01                  # 如果不需要密码则成功
```

#### 2.3 配置时钟同步'

三台机器的时钟同步，这里使用网络同步方式：
```
ntpdate ntp4.aliyun.com         # 使用阿里云时钟同步

# 定时执行时钟同步
crontab  -e
*/1 * * * * /usr/sbin/ntpdate ntp4.aliyun.com;      # 粘贴该命令
```

如果一些大数据环境不能联网，则可以使用某台机器进行同步的方式，如下所示：  

以192.168.52.100这台服务器的时间为准进行时钟同步。  
```
# 第一台机器安装ntp
yum -y install ntpd         
service  ntpd  start
chkconfig ntpd o

# 编辑第一台机器
vim /etc/ntp.conf
# 添加内容：
restrict  192.168.120.0  mask  255.255.255.0  nomodify  notrap
# 注释下列内容：
#server  0.centos.pool.ntp.org
#server  1.centos.pool.ntp.org
#server  2.centos.pool.ntp.org
#server  3.centos.pool.ntp.org
# 恢复如下内容：
server   127.127.1.0  #  local  clock
fudge    127.127.1.0  stratum  10

# 配置第一台机器bios与系统时间同步
vim  /etc/sysconfig/ntpd
# 添加内容
SYNC_HWLOCK=yes


# 配置其他机器同步：
crontab  -e
*/1 * * * * /usr/sbin/ntpdate 192.168.111.100
```

#### 2.4 安装jdk8

```
# 卸载原有JAVA
rpm -e java-1.6.0-openjdk-1.6.0.41-1.13.13.1.el6_8.x86_64    tzdata-java-2016j-1.el6.noarch java-1.7.0-openjdk-1.7.0.131-2.6.9.0.el6_8.x86_64 --nodeps

# 安装jdk8
mkdir -p /usr/local/java
tar -zxvf jdk-8u11-linux-x64.tar.gz -C /usr/local/java

# 配置环境
vim /etc/profile
export JAVA_HOME=/usr/local/java/jdk1.8.0_11
export PATH=:$JAVA_HOME/bin:$PATH

# 环境生效
source /etc/profile
```